# commands to run after installing all files and packages

# add user to some extra groups
# NB You should also check sysfiles2/etc/adduser.conf for default groups to add new users to
for i in audio video cdrom plugdev floppy lp dip
do
    if grep -q "^${i}:" /etc/group
    then
        msg "group $i already exists"
    else
        msg "adding group $i"
        sudo addgroup $i || errmsg "failed to add group: $i"
    fi
    sudo adduser $user $i || errmsg "failed to add user: $user to group: $i"
done
for i in netdev systemd-journal lpadmin scanner bluetooth
do
    if grep -q "^${i}:" /etc/group
    then
        msg "group $i already exists"
    else
        msg "adding group $i"
        sudo addgroup --system "$i" || errmsg "failed to add group: $i"
    fi
    sudo adduser $user $i || errmsg "failed to add user: $user to group: $i"
done

# dmz-cursor-theme may have been installed after bunsen-configs
# so re-run the cursor theme setting in bunsen-configs' postinst script.
DEFAULT_CURSOR_THEME='/usr/share/icons/DMZ-White/cursor.theme'
if update-alternatives --list x-cursor-theme 2>/dev/null | grep -q "$DEFAULT_CURSOR_THEME"
then
    sudo update-alternatives --set x-cursor-theme "$DEFAULT_CURSOR_THEME" || errmsg "failed to edit alternative for x-cursor-theme"
else
    errmsg "failed to edit alternative for x-cursor-theme"
fi

# Now bunsen-os-release is installed, refresh boot menu.
# (now done in bunsen-os-release.postinst)
#sudo update-grub || errmsg "Failed to update grub"

# Add install date to /etc/bunsen/bunsen_install
#sudo echo "Install date: $(date --utc +%FT%T)" >> /etc/bunsen/bunsen_install
sudo tee -a <<< "Install date: $(date --utc +%FT%T)" /etc/bunsen/bunsen_install
